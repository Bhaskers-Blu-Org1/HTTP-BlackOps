using CommonControls;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using TrafficViewerControls.Properties;
using TrafficViewerControls.RequestList;
using TrafficViewerSDK;
using TrafficViewerSDK.Exploiters;
using TrafficViewerSDK.Http;

namespace TrafficViewerControls.DefaultExploiters
{
	public class FormExploiter:IExploiter
	{
		private Fuzzer _fuzzer = new Fuzzer();

		public string Caption
		{
			get { return Resources.FormExploiter; }
		}

		public void Execute(ITrafficDataAccessor curDataAccessor, 
			List<TVRequestInfo> selectedRequests, 
			IHttpClientFactory curHttpClientFactory)
		{
			if (selectedRequests.Count < 1)
			{
				ErrorBox.ShowDialog(Resources.SelectOneRequest);
				return;
			}
            TVRequestInfo req = selectedRequests[0];
            byte[] request = curDataAccessor.LoadRequestData(req.Id);
            HttpRequestInfo reqInfo = new HttpRequestInfo(request);
            reqInfo.IsSecure = req.IsHttps;
            var csrfSetupForm = new CSRFSetupForm(reqInfo, curDataAccessor);
            csrfSetupForm.Show();

		}
	}
}
