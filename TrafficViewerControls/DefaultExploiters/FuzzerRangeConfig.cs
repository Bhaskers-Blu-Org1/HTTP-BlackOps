using CommonControls;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace TrafficViewerControls.DefaultExploiters
{
    public partial class FuzzerRangeConfig : Form
    {
        private FuzzerOptions _options;
        public FuzzerRangeConfig(FuzzerOptions options)
        {
            InitializeComponent();
            _options = options;
          
        }

        private void OKClick(object sender, EventArgs e)
        {
            DialogResult = DialogResult.OK;
            _options.SetRangeDefinitionListRaw(_optionsGrid.GetValues());
            _options.Save();
            //validate the defs
            var defs = _options.GetRangeDefinitionList();
            int charRangeCount = 0;
            foreach (var def in defs)
            {
                if (def.Status == FuzzerRangeStatus.Enabled && def.Type == FuzzerRangeType.CharRange)
                {
                    charRangeCount++;
                }
            }

            if (charRangeCount > 1)
            {
                ErrorBox error = new ErrorBox();
                error.Show("Only the first char range definition will be used");
            }
            Hide();
        }

        private void CancelClick(object sender, EventArgs e)
        {
            DialogResult = DialogResult.Cancel;
            Hide();
        }

        private void FuzzerRangeConfig_Load(object sender, EventArgs e)
        {
            _optionsGrid.SetValues(_options.GetRangeDefinitionListRaw());
        }
    }
}
