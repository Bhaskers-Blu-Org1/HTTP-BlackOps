using CommonControls;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Net;
using System.Net.NetworkInformation;
using System.Net.Security;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using TrafficServer;
using TrafficViewerControls.Browsing;
using TrafficViewerControls.RequestList;
using TrafficViewerInstance;
using TrafficViewerSDK;
using TrafficViewerSDK.Http;

namespace TrafficViewerControls.DefaultExploiters
{
	public partial class CSRFSetupForm : Form
	{
		
        private HttpRequestInfo _reqInfo;
        private ITrafficDataAccessor _curDataAccessor;


        public CSRFSetupForm(HttpRequestInfo reqInfo, ITrafficDataAccessor curDataAccessor)
		{
            _reqInfo = reqInfo;
            _curDataAccessor = curDataAccessor;
			InitializeComponent();
		}

		private void FormForm_Load(object sender, EventArgs e)
		{

           
            _textUrl.Text = String.Format("http://127.0.0.1:{0}/form={1}",
                TrafficViewerOptions.Instance.TrafficServerPort,_reqInfo.Path);
			


            _comboTarget.SelectedIndex = 0;
		}

		

		private void GenerateClick(object sender, EventArgs e)
		{
            FormHelper fh = new FormHelper();
            
            fh.Url = _textUrl.Text;
            fh.IsConfigurable = _comboTarget.SelectedIndex == 0;
            fh.AttackPage = _textTitle.Text;
            fh.AdditionalMarkup = _textMarkup.Text;

         
            byte[] modifiedReq;
            byte[] modifiedResp;
                
            fh.ConvertRequestToForm(_reqInfo, out modifiedReq, out modifiedResp);

            _curDataAccessor.AddRequestResponse(modifiedReq, modifiedResp);

           
		}

		
        
       

	

		
	}
}
